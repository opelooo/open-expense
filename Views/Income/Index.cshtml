@using OpenExpenseApp.Models
@using System.Globalization
@model PaginationModel<Income>

@{
    ViewData["Title"] = "Incomes";
    var indonesianCulture = new CultureInfo("id-ID");
    var returnUrl = Context.Request.Path;
}

<!-- Page Header -->
@await Component.InvokeAsync("PageHeader", new { title = "Incomes", subtitle = "Manage your incomes" })

<!-- Filters & Actions -->
@await Component.InvokeAsync("PageActions", new { 
    pageSize = Model.PageSize, 
    pageSizes = new[] { 5, 10, 25, 50 },
    createUrl = $"/Income/Create?returnUrl={returnUrl}",
    createText = "Tambah Income",
    createCssClass = "btn-success"
})

@if (!Model.Items.Any())
{
    @await Component.InvokeAsync("EmptyState", new {
        iconClass = "bi bi-cash-stack",
        title = "Belum ada income",
        message = "Mulai tambahkan income pertama Anda",
        actionUrl = "/Income/Create",
        actionText = "Tambah Income",
        actionCssClass = "btn-success"
    })
}
else
{
    <!-- Incomes Table -->
    <div class="card border-0 shadow-sm mb-4">
        <div class="card-body p-0">
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead class="table-light">
                        <tr>
                            <th>Tanggal</th>
                            <th>Source Name</th>
                            <th>Type</th>
                            <th>Taxable</th>
                            <th class="text-end">Gross Amount</th>
                            <th class="text-end">Tax Withheld</th>
                            <th class="text-end">Net Amount</th>
                            <th class="text-center">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var income in Model.Items)
                        {
                            var netAmount = income.GrossAmount - (income.TaxWithheld ?? 0);
                            <tr>
                                <td>@income.ReceivedDate.ToString("dd MMM yyyy")</td>
                                <td>@income.SourceName</td>
                                <td>
                                    <span class="badge bg-info">
                                        <i class="bi bi-tag me-1"></i>@income.IncomeType
                                    </span>
                                </td>
                                <td>
                                    @if (income.IsTaxable)
                                    {
                                        <span class="badge bg-warning text-dark">
                                            <i class="bi bi-check-circle me-1"></i>Yes
                                        </span>
                                    }
                                    else
                                    {
                                        <span class="badge bg-secondary">
                                            <i class="bi bi-x-circle me-1"></i>No
                                        </span>
                                    }
                                </td>
                                <td class="text-end fw-semibold">@income.GrossAmount.ToString("C", indonesianCulture)</td>
                                <td class="text-end">@((income.TaxWithheld ?? 0).ToString("C", indonesianCulture))</td>
                                <td class="text-end fw-bold text-success">@netAmount.ToString("C", indonesianCulture)</td>
                                <td class="text-center">
                                    <a href="/Income/Edit/@income.Id" class="btn btn-sm btn-warning">
                                        <i class="bi bi-pencil me-1"></i>Edit
                                    </a>
                                    <form method="post" action="/Income/Delete" style="display:inline;">
                                        <input type="hidden" name="id" value="@income.Id">
                                        <button type="button" class="btn btn-sm btn-danger" onclick="confirmDelete(this)">
                                            <i class="bi bi-trash me-1"></i>Hapus
                                        </button>
                                    </form>
                                </td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Pagination -->
    <div class="d-flex justify-content-between align-items-center">
        <small class="text-muted">Menampilkan @Model.Items.Count dari @Model.TotalItems items</small>
    
        @if (Model.TotalPages > 1)
        {
            <nav aria-label="Page navigation">
                <ul class="pagination mb-0">
                    <!-- Previous Page -->
                    <li class="page-item @(!Model.HasPreviousPage ? "disabled" : "")">
                        <a class="page-link" href="/Income?page=@(Model.CurrentPage - 1)&pageSize=@Model.PageSize">
                            <i class="bi bi-chevron-left"></i>
                        </a>
                    </li>

                    <!-- Page Numbers -->
                    @{
                        int startPage = Math.Max(1, Model.CurrentPage - 2);
                        int endPage = Math.Min(Model.TotalPages, Model.CurrentPage + 2);

                        if (startPage > 1)
                        {
                            <li class="page-item"><a class="page-link" href="/Income?page=1&pageSize=@Model.PageSize">1</a></li>
                            if (startPage > 2)
                            {
                                <li class="page-item disabled"><span class="page-link">...</span></li>
                            }
                        }

                        for (int i = startPage; i <= endPage; i++)
                        {
                            <li class="page-item @(i == Model.CurrentPage ? "active" : "")">
                                <a class="page-link" href="/Income?page=@i&pageSize=@Model.PageSize">@i</a>
                            </li>
                        }

                        if (endPage < Model.TotalPages)
                        {
                            if (endPage < Model.TotalPages - 1)
                            {
                                <li class="page-item disabled"><span class="page-link">...</span></li>
                            }
                            <li class="page-item"><a class="page-link" href="/Income?page=@Model.TotalPages&pageSize=@Model.PageSize">@Model.TotalPages</a></li>
                        }
                    }

                    <!-- Next Page -->
                    <li class="page-item @(!Model.HasNextPage ? "disabled" : "")">
                        <a class="page-link" href="/Income?page=@(Model.CurrentPage + 1)&pageSize=@Model.PageSize">
                            <i class="bi bi-chevron-right"></i>
                        </a>
                    </li>
                </ul>
            </nav>
        }
    </div>
}
